<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script type="importmap">
        {
            "imports": {
               "three": "https://unpkg.com/three@0.180.0/build/three.module.js",
               "three/addons/": "https://unpkg.com/three@0.180.0/examples/jsm/"
            }
            

        }
     </script>    

     <style>
        body{
            margin: 0;
        }
     </style>
</head>
<body>

    <div id="sceneDiv"  style="width: 70%; height: 500px; margin: auto;">

    </div>

    <p style="margin: 10px; text-align: center;">
        Þú getur fært sverðið í kringum með Orbit Controls og þú get ýtta á takkan til að kveikja eða slökkva á Orbit Controls
    </p>
    <button id="takki" style="display: block; margin: auto;">
        Toggle Orbit Movements
    </button>

    <script type="module">
        
    import * as THREE from 'three';
    import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

    import { animate, utils  } from 'https://esm.sh/animejs';

    const sceneDiv = document.getElementById("sceneDiv");
    const takki = document.getElementById("takki");

    // MISSING TEXTURE AND ANIMATION

    // Scene 
    const scene = new THREE.Scene();

    const textureLoader = new THREE.TextureLoader();

    textureLoader.load("./ai-generated-sky-blue-design-refreshing-tribute-to-heavens-generative-ai-photo.jpeg", (t) => {
        scene.background = t
    })

    // Camera
    const camera = new THREE.PerspectiveCamera(60, sceneDiv.clientWidth / sceneDiv.clientHeight, 0.1, 1000);
    camera.position.set(10, 6, 0);

    // Renderer
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(sceneDiv.clientWidth, sceneDiv.clientHeight);
    renderer.shadowMap.enabled = true;
    sceneDiv.appendChild(renderer.domElement);

    // Controls
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    controls.enabled = false

    // Lights
    const ambientLight = new THREE.AmbientLight(0xffffff,1)
    scene.add(ambientLight)

    const dirLight = new THREE.DirectionalLight(0xffffff, 1);
    dirLight.position.set(0.5, 1, 0);

    dirLight.castShadow = true
    scene.add(dirLight);

    const texture = textureLoader.load("./chevalier_sword/textures/DefaultMaterial_baseColor.jpeg")

    const geometry = new THREE.BoxGeometry( 2, 0.2, 2 );
    const material = new THREE.MeshStandardMaterial({map: texture});
    const mesh = new THREE.Mesh( geometry, material );
    mesh.receiveShadow = true;
    scene.add( mesh );
    mesh.position.set(0,-1.5,0)

    // Load GLTF model

    const loader = new GLTFLoader();
    
    let sword;

    let loaded = false;

    loader.load(
      "./chevalier_sword/scene.gltf",
      (gltf) => {

        loaded = true

        gltf.scene.traverse((child) => {
            if (child.isMesh){
                child.castShadow = true;
            }
        })

        sword = gltf.scene
        // ADD SHADOWS AND ADD DIV AND BUTTONS  !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

        sword.rotation.x = THREE.MathUtils.degToRad(-90);

        const zoomAnimation = animate(camera.position, {
            x: 2,
            y: 1,
            duration: 900,
            ease: "inOut",
            onComplete: (a) => {controls.enabled = true}
        })

        const rotationAnimation = animate(sword.rotation, {
            z: THREE.MathUtils.degToRad(360),
            ease: "inOut",
            duration: 1000,
            loop: true,
        })

        scene.add(sword);
        console.log(sword)

      },
      (xhr) => console.log(`Model ${Math.round((xhr.loaded / xhr.total) * 100)}% loaded`),
    );
    // Resize
    window.addEventListener('resize', () => {
      camera.aspect = sceneDiv.clientWidth / sceneDiv.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(sceneDiv.clientWidth, sceneDiv.clientHeight);
    });

    renderer.setAnimationLoop(() => {
            controls.update();
            renderer.render(scene, camera);
    })

    takki.addEventListener("click", (e)=> {
        if (loaded == true){
            controls.enabled = !controls.enabled
        }
    })

    // Animation loop (just rendering, no animations)
    

    /*
    // þetta virkar ekki og ég veit ekki að hverju

    import * as THREE from 'three';
    import {OrbitControls} from 'three/addons/controls/orbitControls.js'
    import {GLTFLoader} from 'three/addons/loaders/GLTFLoader.js'

    // ÞARF ANIME.JS TIL AÐ ANIMATE-A OG ÞARF AÐ BÆTA VIÐ TEXTURE

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x091f47);

    const camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.01, 10 ); // breyta þetta á eftir
    camera.position.set = (1,0,0);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setPixelRatio(window.devicePixelRatio); 
    renderer.setSize(window.innerWidth, window.innerHeight); // setjir stærðin í vefsíðinu
    document.body.appendChild(renderer.domElement); // bætta við í html

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    // BREYTA ÞETTA Á EFTIR

    scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 1));
    const dirLight = new THREE.DirectionalLight(0xffffff, 1);
    dirLight.position.set(5, 10, 7.5);
    scene.add(dirLight);

    const loader = new GLTFLoader();

    loader.load(
        "./chevalier_sword/scene.gltf",
        (gltf) => {
            scene.add(gltf.scene)
        },
        (xhr) => console.log(`Model ${Math.round((xhr.loaded / xhr.total) * 100)}% loaded`), // prentar þetta á meðan að loada
        (error) => console.error("Model load error:", error)
    );// find path and add a function which adds the model to the scene

    // kannski þarf þetta eða ekki dunno
    window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
    });

    renderer.setAnimationLoop(() => {
        controls.update();
        renderer.render(scene, camera);
    });

    */
        
    </script>
    
</body>
</html>